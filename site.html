<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="utf-8">
    <title>Статус сервера</title>
    <style>
      body {
        font-family: monospace;
        text-align: center;
        background: #000;
        color: #fff;
      }
      #status {
        font-size: 1.5em;
      }
      #players {
        margin-top: 1rem;
        color: #0f0;
      }
      #player-list {
        margin-top: 1rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }
      .player {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 64px;
      }
      .player img {
        width: 64px;
        height: 64px;
        border-radius: 8px;
        image-rendering: pixelated;
      }
      .player span {
        font-size: 0.8em;
        margin-top: 4px;
        color: #ccc;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <h1>Статус сервера</h1>
    <p id="ip">Пінг...</p>
    <div id="status"></div>
    <div id="players"></div>
    <div id="player-list"></div>

    <script>
      const serverIP = "93.127.121.47:7777"; // <-- твій IP
      document.getElementById("ip").textContent = `IP: ${serverIP}`;

      async function checkServer() {
        try {
          const response = await fetch(`https://api.mcsrvstat.us/2/${serverIP}?t=${Date.now()}`);
          const data = await response.json();

          const statusElem = document.getElementById("status");
          const playersElem = document.getElementById("players");
          const playerListElem = document.getElementById("player-list");

          if (data.online) {
            statusElem.textContent = "✅ Сервер онлайн";
            playersElem.textContent = `Гравців онлайн: ${data.players.online} / ${data.players.max}`;
            playerListElem.innerHTML = "";

            if (data.players.list && data.players.list.length > 0) {
              data.players.list.forEach(player => {
                const div = document.createElement("div");
                div.className = "player";

                // аватар через Minotar (отримує обличчя з Mojang)
                const img = document.createElement("img");
                img.src = `https://minotar.net/helm/${player}/64.png`;

                const name = document.createElement("span");
                name.textContent = player;

                div.appendChild(img);
                div.appendChild(name);
                playerListElem.appendChild(div);
              });
            } else {
              playerListElem.textContent = "(нема гравців онлайн)";
            }
          } else {
            statusElem.textContent = "❌ Сервер офлайн";
            playersElem.textContent = "";
            playerListElem.innerHTML = "";
          }
        } catch (error) {
            if (error instanceof TypeError) {
                // Зазвичай TypeError виникає через CORS або network issues
                document.getElementById("status").textContent = "⚠️ API недоступне або забагато запитів";
            } else {
                document.getElementById("status").textContent = "⚠️ Помилка при пінгу";
                console.error(error);
            }
        }
      }

      checkServer();
      setInterval(checkServer, 3000);
      // Добавити інтервал, якщо TypeError
    </script>
  </body>
</html>
